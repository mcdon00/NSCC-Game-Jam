<!DOCTYPE html>

<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Brickbreaker</title>
        <style type="text/css">
            body{
                padding:0;
                margin:0;
            }
        </style>
        <script type="text/javascript" src="classes/Collision.js"></script>
        <script type="text/javascript" src="http://code.createjs.com/createjs-2013.02.12.min.js"></script>
        <script type="text/javascript" src="http://code.createjs.com/preloadjs-0.2.0.min.js"></script>
        <script type="text/javascript" src="classes/Character.js"></script>
        <script type="text/javascript" src="classes/Enemy.js"></script>
        <script type="text/javascript" src="classes/Bullet.js"></script>
        <script type="text/javascript" src="classes/GameWorld.js"></script>
        <script type="text/javascript" src="classes/AssetManager.js"></script>
        <script type="text/javascript">

        var delta;
        var angle;
        var assetManager;
        var enemies = [];

        function init(){

        	//Create stage
        	canvas = document.getElementById("canvas");
        	canvas.height = 600;
			canvas.width = 800;

			stage = new createjs.Stage(canvas);

            gameWorld = new GameWorld();
            gameWorld.init(stage,"lib/ApplianceBGFlash.png");

        	player = new Character(stage);
        	player.init();

            enemy = new Enemy(stage);
            enemy.init();

        	createjs.Ticker.addEventListener("tick", tick);
        }

        function addBullet(){
			bullet = new Bullet(stage);
        	bullet.init();     
        	stage.addChild(bullet.clip); 
        	console.log('added bullet');  	
        }

        function onMouseDown(){
        	addBullet();
        }
        function checkDirection(e){
            //Moving the ship\
            down=false;
            up=false;
            right=false;
            left=false;

            if(e.keyCode == 40){
                down = true;
            }
            else if(e.keyCode == 38){
                up = true;
            }
            else if(e.keyCode == 39){
                right = true;
            }
            else if(e.keyCode == 37){
                left = true;
            }
        }

        function tick(event){

        	delta = event.delta;
        	player.move();

            
            enemy.checkPlayerPos(player.clip.x,player.clip.y);


            //-------------collision detection
            // enemy/player
            var intersection = ndgmr.checkRectCollision(player.clip,enemy.clip);
            if(intersection){
                stage.removeChild(enemy.clip);
                enemy.clip.x = -2000;
            }
            // map bounds

            player.speed = 10;
            if(gameWorld.leftBound.hitTest(player.clip.x,player.clip.y)){
                if(left){
                    player.speed = 0;
                    console.log(gameWorld.leftBound);
                }
            }else if(gameWorld.rightBound.hitTest(player.clip.x,player.clip.y)){
                if(right){
                    player.speed = 0;
                }
            }else if(gameWorld.topBound.hitTest(player.clip.x,player.clip.y)){
                if(up){
                    player.speed = 0;
                }
            }else if(gameWorld.bottomBound.hitTest(player.clip.x,player.clip.y)){
                if(down){
                    player.speed = 0;
                }
            }






        	stage.update(delta);        	
        }

        document.addEventListener("mousedown", onMouseDown, true);
        document.addEventListener("keypress", checkDirection, true);


        </script>
    </head>
    <body onload="init();">
        <canvas id="canvas" style="background-color:black;"></canvas>
        <script type="text/javascript" src="script.js"></script>
    </body>
</html>